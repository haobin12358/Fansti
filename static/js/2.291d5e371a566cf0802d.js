webpackJsonp([2],{"1uP7":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=s("//Fk"),n=s.n(a),i=s("Qwu5"),r={name:"UE",data:function(){return{editor:null}},props:{defaultMsg:{type:String},config:{type:Object}},mounted:function(){var t=this;this.editor=UE.getEditor("editor",this.config),this.editor.addListener("ready",function(){t.editor.setContent(t.defaultMsg)})},methods:{getUEContent:function(){return this.editor.getContent()}},destroyed:function(){this.editor.destroy()}},l={render:function(){this.$createElement;this._self._c;return this._m(0)},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("div",[e("script",{attrs:{id:"editor",type:"text/plain"}})])}]};var o=s("VU/8")(r,l,!1,function(t){s("wEp/")},"data-v-7a38ac46",null).exports,c=s("mYEk"),u=s("P9l9"),d=s("mtWM"),p=s.n(d),g={name:"news_manage",data:function(){return{news:[],newsManage:!0,tabs_data:[{name:"上传",click:!1,url:""},{name:"管理",click:!0,url:""}],titleInput:"",fromInput:"",imageUrl:"",defaultMsg:"",page_size:10,total_num:5,current_page:1,total_page:0,newsContent:"",imageUrlStatus:!0,errorImg:'this.src="'+s("A5Lb")+'"',abstract:"",editNewsStatus:!1,newsId:""}},components:{tabs:i.a,UE:o,page:c.a},methods:{getData:function(t){var e=this;p.a.get(u.a.get_news_all,{params:{page_size:this.page_size,page_num:Number(t||this.current_page)}}).then(function(t){if(200==t.data.status){e.news=t.data.data;for(var s=0;s<e.news.length;s++)e.abstract=e.news[s].news_all.replace(/<[^<>]+?>/g,"").replace(/(\s|&nbsp;)+/g,""),e.news[s].abstract=e.abstract,console.log(e.news[s]);e.total_num=t.data.data.length,e.total_page=Math.ceil(e.total_num/e.page_size)}else e.$message.error(t.data.message)},function(t){e.$message.error(t.data.message)})},pageChange:function(t){if(t==this.current_page)return this.$message({message:"这已经是第"+t+"页数据了",type:"warning"}),!1;this.current_page=t,this.getData(t)},tabClick:function(t){for(var e=this.tabs_data,s=0;s<e.length;s++)e[s].click=!1;e[t].click=!0,this.tabs_data=[].concat(e),0==t?this.newsManage=!1:1==t&&(this.newsManage=!0)},uploadPicture:function(t,e){var s=this,a=new FormData;a.append("file",e.raw),a.append("FileType","NewsPic"),a.append("index",1),p.a.post(u.a.upload_files,a).then(function(t){200==t.data.status?s.$message({type:"success",message:t.data.message}):s.$message({type:"error",message:t.data.message}),console.log(t.data),s.imageUrl=t.data.data},function(t){s.$message({type:"error",message:"服务器请求失败，请稍后再试"})})},beforeAvatarUpload:function(t){this.$message({type:"warning",message:"上传中，请等待"});var e=this;return new n.a(function(s,a){var n=new FileReader;n.onload=function(t){var a=new Image;a.onload=function(){(this.width/this.height>2.7||this.width/this.height<2.1)&&e.$notify({title:"提示",message:"建议上传宽高比为2.1~2.7的图片",type:"warning"}),s()},a.src=t.target.result},n.readAsDataURL(t)})},giveUpEdit:function(){var t=this;""==this.titleInput&&""==this.fromInput&&""==this.imageUrl&&""==this.defaultMsg?this.tabClick(1):""==this.titleInput&&""==this.fromInput&&""==this.imageUrl&&""==this.defaultMsg||this.$confirm("此操作将不保存本页变化的内容","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){t.newsId="",t.titleInput="",t.fromInput="",t.imageUrl="",t.defaultMsg="",t.tabClick(1)})},uploadNews:function(){var t=this;if(""!=this.newsId)this.updateNews();else if(this.newsContent=this.$refs.ue.getUEContent(),""==this.titleInput)this.$message.error("请填写新闻标题");else if(""==this.fromInput)this.$message.error("请填写新闻来源");else if(""==this.newsContent)this.$message.error("请撰写新闻正文");else{""==this.imageUrl&&(this.imageUrl="null");var e={news_title:this.titleInput,news_from:this.fromInput,news_picture:this.imageUrl,news_all:this.newsContent};p.a.post(u.a.new_news,e).then(function(e){200==e.data.status?(t.$message({type:"success",message:e.data.message}),t.getData(1),t.tabClick(1),t.titleInput="",t.fromInput="",t.imageUrl=""):t.$message({type:"error",message:e.data.message})},function(e){t.$message({type:"error",message:"服务器请求失败，请稍后再试"})})}},updateNews:function(){var t=this;if(this.newsContent=this.$refs.ue.getUEContent(),""==this.titleInput)this.$message.error("请填写新闻标题");else if(""==this.fromInput)this.$message.error("请填写新闻来源");else if(""==this.newsContent)this.$message.error("请撰写新闻正文");else{""==this.imageUrl&&(this.imageUrl="null");var e={news_title:this.titleInput,news_from:this.fromInput,news_picture:this.imageUrl,news_all:this.newsContent};p.a.post(u.a.update_news+"?id="+this.newsId,e).then(function(e){200==e.data.status?(t.$message({type:"success",message:e.data.message}),t.getData(1),t.tabClick(1),t.titleInput="",t.fromInput="",t.imageUrl="",t.defaultMsg=""):t.$message({type:"error",message:e.data.message})},function(e){t.$message({type:"error",message:"服务器请求失败，请稍后再试"})})}},closeNews:function(t){var e=this;this.$confirm("此操作将删除该新闻","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){p.a.post(u.a.update_status+"?id="+t.id,{news_status:0}).then(function(t){200==t.data.status?(e.getData(1),e.$message({type:"success",message:"新闻删除成功"})):e.$message.error(t.data.message)},function(t){console.log(t)})})},editNews:function(t){this.editNewsStatus=!0,this.newsId=t.id,this.tabClick(0),this.titleInput=t.news_title,this.fromInput=t.news_from,this.imageUrl=t.news_picture,this.defaultMsg=t.news_all}},created:function(){this.getData(1)}},m={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("tabs",{attrs:{tabs:t.tabs_data},on:{tabClick:t.tabClick}}),t._v(" "),t.newsManage?s("div",[s("div",{staticClass:"page-box"},[s("page",{attrs:{total:t.total_page}})],1),t._v(" "),t._l(t.news,function(e){return s("div",{staticClass:"news-manage"},[s("div",{staticClass:"news-container"},[s("img",{staticClass:"news-image",attrs:{src:e.news_picture,onerror:t.errorImg}}),t._v(" "),s("div",{staticClass:"news-text"},[s("div",{staticClass:"news-title"},[t._v(t._s(e.news_title))]),t._v(" "),s("div",{staticClass:"news-from-date"},[t._v(t._s(e.news_from)+"    "+t._s(e.news_time))]),t._v(" "),s("div",{staticClass:"news-body"},[t._v("摘要："+t._s(e.abstract))])]),t._v(" "),s("div",{staticClass:"news-edit",on:{click:function(s){t.editNews(e)}}},[t._v("编 辑")]),t._v(" "),s("div",{staticClass:"news-close",on:{click:function(s){t.closeNews(e)}}},[t._v("删 除")])])])})],2):t._e(),t._v(" "),t.newsManage?t._e():s("div",[s("div",{staticClass:"news-upload"},[s("div",{staticClass:"news-upload-title"},[s("div",{staticClass:"left-text required"},[t._v("新闻标题：")]),t._v(" "),s("el-input",{staticClass:"right-input",attrs:{placeholder:"此处为新闻标题"},model:{value:t.titleInput,callback:function(e){t.titleInput=e},expression:"titleInput"}})],1),t._v(" "),s("div",{staticClass:"news-upload-from"},[s("div",{staticClass:"left-text required"},[t._v("新闻来源：")]),t._v(" "),s("el-input",{staticClass:"right-input",attrs:{placeholder:"此处为新闻来源"},model:{value:t.fromInput,callback:function(e){t.fromInput=e},expression:"fromInput"}})],1),t._v(" "),s("div",{staticClass:"news-upload-image"},[s("div",{staticClass:"left-text"},[t._v("标题图片：")]),t._v(" "),s("el-upload",{staticClass:"avatar-uploader",attrs:{action:"https://fstwechat.com/fansti/news/upload_files","show-file-list":!1,"on-success":t.uploadPicture,"before-upload":t.beforeAvatarUpload}},[t.imageUrl?s("img",{staticClass:"avatar",attrs:{src:t.imageUrl}}):s("i",{staticClass:"el-icon-plus avatar-uploader-icon"})]),t._v(" "),t.imageUrlStatus?s("div",{staticClass:"image-upload-done"},[s("p",[t._v("注意：")]),t._v(" "),s("p",[t._v("1、图片文件大小不超过 20MB")]),t._v(" "),s("p",[t._v("2、图片的格式须为 JPG 或 PNG")]),t._v(" "),s("p",[t._v("3、图片宽高比的适宜范围为 2.1~2.7")])]):t._e()],1),t._v(" "),s("div",{staticClass:"news-upload-body"},[s("div",{staticClass:"left-text required"},[t._v("新闻正文：")]),t._v(" "),s("div",{staticClass:"ueditor"},[s("UE",{ref:"ue",attrs:{defaultMsg:t.defaultMsg}})],1)]),t._v(" "),s("el-tooltip",{attrs:{content:"放弃本次编辑",placement:"top"}},[s("el-button",{staticClass:"give-up-btn",on:{click:t.giveUpEdit}},[t._v("放弃编辑")])],1),t._v(" "),s("el-button",{staticClass:"upload-two-btn",on:{click:t.uploadNews}},[t._v("上 传")])],1)])],1)},staticRenderFns:[]};var f=s("VU/8")(g,m,!1,function(t){s("4AJR")},"data-v-5d6b02ef",null);e.default=f.exports},"4AJR":function(t,e){},A5Lb:function(t,e,s){t.exports=s.p+"static/img/newsPic.0f8e50a.jpg"},NIdp:function(t,e){},Qwu5:function(t,e,s){"use strict";var a={data:function(){return{name:""}},props:{tabs:{type:Array,default:null}},components:{},methods:{tabClick:function(t){if(this.tabs[t].click)return!1;this.$emit("tabClick",t)}},created:function(){}},n={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"m-tab"},[t._l(t.tabs,function(e,a){return[s("span",[s("span",{staticClass:"m-tab-link",class:e.click?"active":"",on:{click:function(e){t.tabClick(a)}}},[t._v(t._s(e.name))]),t._v(" "),a!=t.tabs.length-1?s("span",{staticClass:"m-tab-line"},[t._v("/")]):t._e()])]})],2)},staticRenderFns:[]};var i=s("VU/8")(a,n,!1,function(t){s("NIdp")},"data-v-2a5b772e",null);e.a=i.exports},"wEp/":function(t,e){}});
//# sourceMappingURL=2.291d5e371a566cf0802d.js.map